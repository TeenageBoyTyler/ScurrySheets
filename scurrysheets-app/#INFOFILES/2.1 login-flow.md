# Login/Connect Process

## Overview
The login/connect process provides streamlined authentication with Google Drive as the primary storage provider and requires users to provide their own Google Vision API key. The interface prioritizes simplicity while ensuring users are connected to the internet.

## Step 1: Google Drive Authentication
**Fullscreen authentication interface**

- Clean, centered interface with scurrysheets logo/name at top
- Prominent "Connect with Google Drive" button
- Simple animations for hover/focus states implemented with Svelte transitions
- Authentication handled through Supabase Auth with Google OAuth provider
- SvelteKit route handlers for auth callback processing
- Success leads to Google Vision API key setup (if not previously provided)
- **Error handling**: Follows standard error handling guidelines for connectivity issues (see Error Handling Guidelines in global-systems.md)
- **Implementation**: Uses Supabase Auth helpers for SvelteKit with proper session management

## Step 2: Google Vision API Key Setup
**Modal overlay after successful authentication**

- Appears after Google authentication if user hasn't provided a Vision API key
- Explains the need for a personal Google Vision API key
- Provides step-by-step instructions for setting up a Google Cloud project
- Includes a secure input field for entering the Vision API key
- Save button to store the API key in the user's Supabase profile
- Links to detailed documentation on setting up Google Vision API
- **Error handling**: Validates the API key format and provides feedback on invalid keys
- **Implementation**: Svelte component with modal dialog and form validation

## Authentication Process
**OAuth flow with Google via Supabase Auth**

- User clicks Google Drive button
- Supabase Auth initiates OAuth authentication window
- User grants necessary permissions for:
  - Document storage access
  - Cloud Monitoring access (for Vision API usage tracking)
- App receives OAuth token for Google services via Supabase Auth
- User identity established through Google account
- User provides their own Google Vision API key
- Key is securely stored in Supabase Database under the user's profile with RLS protection
- All subsequent operations occur directly between app and Google services
- **Processing**: Automatic creation of `.scurrysheets/` folder in user's Google Drive
- **Monitoring**: Access established to track Vision API usage via Cloud Monitoring API
- **Implementation**: 
  - Supabase Auth + Google Drive API integration using SvelteKit endpoints
  - Session management with Supabase Auth helpers for SvelteKit
  - Route protection with proper auth guards

## Vision API Key Technical Implementation
**User-provided API keys model**

- Users create their own Google Cloud project
- Enable the Vision API in their GCP console
- Generate an API key with appropriate restrictions
- Store key in Supabase Database under their user ID with proper RLS policies
- All Vision API requests use the user's personal key
- API calls handled through client-side requests or Supabase Edge Functions when additional security is needed
- Benefits: 
  - No server-side billing for Vision API usage
  - Works with Supabase free tier plan
  - Users have full control over their API quotas
  - Transparent usage tracking in users' Google Cloud consoles
- **Implementation**: 
  - Key management through Supabase Database with proper encryption
  - Supabase RLS policies to enforce user-specific access
  - API key validation on both client and server

## GitHub Codespaces Integration
**Development environment configuration**

- Configured for seamless development with GitHub Codespaces
- `.devcontainer` configuration for consistent development environment
- Port forwarding for local development server
- Environment variables for local development
- Supabase local development setup
- Mock authentication for development purposes
- Development-specific routes and handlers for testing authentication flows

## Related Documentation
- For cloud storage structure details, see the Cloud Storage System section in global-systems.md
- For complete error handling information, see the Error Handling Guidelines section in global-systems.md
- For connectivity requirements, see the Internet Connectivity Requirements section in global-systems.md
- For detailed Vision API setup instructions, see the VISION_API_SETUP.md file in the docs directory